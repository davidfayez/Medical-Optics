        public JsonResult OpenFinancialPeriodById(int id)
        {
            var OpenFinancialPeriods = _glFinancialPeriodBLL.GetAllFinancialPeriodVM().Where(s => s.IsOpen == true).FirstOrDefault();
            var VouchersInFinancialPeriods = _glJournalVoucherBLL.GetAll().Where(s => (s.VoucherDate >= OpenFinancialPeriods.DateFrom && s.VoucherDate <= OpenFinancialPeriods.DateTo)).Select(s => s.ListDetails).ToList();
            var AccountsDB = _glAccountBLL.GetAll();
            //if (VouchersInFinancialPeriods.Where(s => s.IsPosted == false).ToList().Count > 0)
            //{
            //    return Json("NO");
            //}
            List<AddEditGlJournalVoucherVM.AddEditGlJournalVoucherDetailVM> ListDetails = new List<AddEditGlJournalVoucherVM.AddEditGlJournalVoucherDetailVM>();
            foreach (var account in AccountsDB)
            {
                foreach (var voucherDetails in VouchersInFinancialPeriods.GroupBy(s => s.GroupBy(x=>x.FK_GlAccountId)))
                {
                    var details = new AddEditGlJournalVoucherVM.AddEditGlJournalVoucherDetailVM();
                    if (account.Id== voucherDetails.FirstOrDefault().Select(x=>x.FK_GlAccountId).FirstOrDefault())
                    {
                        details.Debit = voucherDetails.Select(s => s.Sum(x => x.Debit * x.CurrencyFactor)).FirstOrDefault();
                        details.Credit = voucherDetails.Select(s => s.Sum(x => x.Credit * x.CurrencyFactor)).FirstOrDefault();
                        details.FK_GlAccountId = voucherDetails.FirstOrDefault().Select(x => x.FK_GlAccountId).FirstOrDefault();
                        ListDetails.Add(details);
                    }

                    //foreach (var voucher in voucherDetails)
                    //{
                    //    var details = new AddEditGlJournalVoucherVM.AddEditGlJournalVoucherDetailVM();
                    //    details.Debit = voucher.Debit * voucher.CurrencyFactor;
                    //    details.Credit = voucher.Credit * voucher.CurrencyFactor;
                    //    details.FK_GlAccountId = voucher.FK_GlAccountId;
                    //    ListDetails.Add(details);
                    //}
                }

                
                }
            var Accounts = ListDetails.GroupBy(s => s.FK_GlAccountId);
            try
            {
                foreach (var account in Accounts)
                 {
                    GridGlAccountOpeningBalanceVM AccountOpeningBalanceVM = new GridGlAccountOpeningBalanceVM();
                    var TotalDebit= account.Sum(s => s.Debit);
                    var TotalCredit = account.Sum(s => s.Credit);
                    AccountOpeningBalanceVM.accountId =account.Select(s => s.FK_GlAccountId).FirstOrDefault();
                    AccountOpeningBalanceVM.financialPeriodId = id;
                    if (TotalDebit > TotalCredit)
                        AccountOpeningBalanceVM.debit = Convert.ToDecimal(TotalDebit - TotalCredit);
                    else if(TotalCredit > TotalDebit)
                        AccountOpeningBalanceVM.credit = Convert.ToDecimal(TotalCredit - TotalDebit);
                    
                        _glAccountOpeningBalanceBLL.AddRow(AccountOpeningBalanceVM);
                }
                var GlFinancialPeriodClosedVM = _glFinancialPeriodBLL.GetFinancialPeriodVMById(OpenFinancialPeriods.Id);
                GlFinancialPeriodClosedVM.IsOpen = false;
                _glFinancialPeriodBLL.UpdateFinancialPeriod(OpenFinancialPeriods.Id, GlFinancialPeriodClosedVM);
                var GlFinancialPeriodOpenedVM = _glFinancialPeriodBLL.GetFinancialPeriodVMById(id);
                GlFinancialPeriodOpenedVM.IsOpen = true;
                _glFinancialPeriodBLL.UpdateFinancialPeriod(id, GlFinancialPeriodOpenedVM);
                return Json(true);
            }
            catch (Exception exception)
                {
                }
            return Json(false);
        }
